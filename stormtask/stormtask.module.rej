***************
*** 1,5 ****
  <?php
- // $Id: stormtask.module,v 1.6.4.30 2009/06/28 18:13:58 magnity Exp $
  
  /**
   * @file
--- 1,5 ----
  <?php
+ // $Id: stormtask.module,v 1.6.4.29 2009/06/08 14:01:54 magnity Exp $
  
  /**
   * @file
***************
*** 185,193 ****
      'type' => MENU_NORMAL_ITEM,
      'file' => 'stormtask.admin.inc',
    );
    return $items;
  }
  
  function stormtask_theme() {
    return array(
      'stormtask_list' => array(
--- 185,257 ----
      'type' => MENU_NORMAL_ITEM,
      'file' => 'stormtask.admin.inc',
    );
+ 
+   $items['admin/storm/tasks'] = array(
+     'title' => t('Storm Task'),
+     'description' => t('Storm Tasks Administration Page'),
+     'page callback' => 'drupal_get_form',
+     'page arguments' => array('stormtask_admin_settings'),
+     'access arguments' => array('access administration pages'),
+     'type' => MENU_LOCAL_TASK,
+   );
+ 
    return $items;
  }
  
+ 
+ function stormtask_admin_settings() {
+   $form = array();
+   
+   $form['stormtask_enable_ganttchart'] = array(
+     '#type' => 'checkbox',
+     '#title' => t('Enable Gantt Charts (experimental feature)'),
+     '#default_value' => variable_get('stormtask_enable_ganttchart', False),
+     '#description' => t('First get jsgantt.zip from http://jsgantt.com and put jsgantt.js andf jsgantt.css in directory   <i>sites/all/libraries/jsgantt</i> then enable this checkbox.'),
+   );
+ 
+   $form['stormtask_jsgantt_location'] = array(
+     '#type' => 'textfield',
+     '#title' => t('Location of jsgantt library'),
+     '#default_value' => variable_get('stormtask_jsgantt_location', t('sites/all/libraries/jsgantt')),
+     '#description' => t('The directory that contains the jsgantt library ( sites/all/libraries/jsgantt is recommended )'),
+     '#size' => 50,
+     '#after_build' => array('jsgantt_check_directory'),
+   );
+ 
+ 
+   $form['stormtask_jsgantt_options'] = array(
+     '#type' => 'checkboxes',
+     '#title' => t('Chart display options'),
+     '#default_value' => variable_get('stormtask_jsgantt_options', array('ShowStartDate','ShowEndDate','ShowDur')),
+     '#options' => array(
+       'ShowStartDate' => t('Show Start Date'),
+       'ShowEndDate' => t('Show End Date'),
+       'ShowDur' => t('Show Duration'),
+     ),
+     '#description' => t('Choose display options for gantt chart.'),
+   );
+ 
+ 
+   $form['stormtask_jsgantt_color'] = array(
+     '#type' => 'textfield',
+     '#title' => t('Gantt chart color'),
+     '#default_value' => variable_get('stormtask_jsgantt_color', '00CCFF'),
+     '#description' => t('Enter color for gant chart bars.'),
+     '#size' => 6,
+   );
+ 
+   return system_settings_form($form);
+ }
+ 
+ function jsgantt_check_directory($form_element) {
+   $file = $form_element['#value']."/jsgantt.js";
+   if (!file_exists($file)){
+      form_set_error($form_element['#name'], t('The file %file does not exist.', array('%file' => $file)));
+   }
+   return $form_element;
+ }
+ 
+ 
  function stormtask_theme() {
    return array(
      'stormtask_list' => array(
***************
*** 653,672 ****
    return $rows;
  }
  
- function stormtask_admin_settings() {
-   $form = array();
-   
-   $form['stormtask_jsgantt_location'] = array(
-     '#type' => 'textfield',
-     '#title' => t('Location of jsGantt library'),
-     '#default_value' => variable_get('stormtask_jsgantt_location', t('sites/all/libraries/jsgantt')),
-     '#description' => t('The directory that contains the jsGantt library (sites/all/libraries/jsgantt is recommended)'),
-     '#size' => 50,
-   );
-   
-   return system_settings_form($form);
- }
- 
  function stormtask_views_api() {
    return array(
      'api' => 2,
--- 717,722 ----
    return $rows;
  }
  
  function stormtask_views_api() {
    return array(
      'api' => 2,
